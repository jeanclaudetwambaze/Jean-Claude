<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AMAKURU Admin</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
html,body { font-family: Inter, system-ui, Arial; background:#f2f4f7; color:#111; }
a { text-decoration:none; color:inherit; }
.topbar { background:#d40000; color:#fff; padding:8px 16px; display:flex; justify-content:space-between; align-items:center; }
.topbar a { color:#fff; margin-right:12px; }
header { background:#fff; padding:12px 16px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #e6e9ee; }
.brand { font-weight:800; font-size:24px; color:#d40000; }
.btn { padding:6px 12px; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
.btn.primary { background:#d40000; color:#fff; }
.btn.secondary { background:#fff; color:#d40000; border:1px solid #d40000; }
.container { max-width:1150px; margin:18px auto; padding:0 16px; display:grid; grid-template-columns:1fr 320px; gap:18px; }
.cards { display:grid; grid-template-columns: repeat(3,1fr); gap:14px; }
.card { background:#fff; border-radius:8px; overflow:hidden; padding:10px; box-shadow:0 6px 18px rgba(16,24,40,0.04); display:flex; flex-direction:column; gap:6px; }
.card img { width:100%; height:140px; object-fit:cover; border-radius:6px; }
.card-controls { display:flex; gap:6px; justify-content:flex-end; }
.icon-btn { padding:6px 8px; border:1px solid #eee; border-radius:6px; cursor:pointer; font-weight:600; background:transparent; }
.modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; }
.modal-content { background:#fff; padding:16px; border-radius:8px; width:400px; max-width:90%; display:flex; flex-direction:column; gap:8px; }
input, textarea, select { width:100%; padding:8px; border:1px solid #ddd; border-radius:6px; }
</style>
</head>
<body>

<div class="topbar">
  <div>AMAKURU Admin Panel</div>
  <div>
    <button class="btn primary" onclick="openAdmin()">+ New Post</button>
    <button class="btn secondary" onclick="prefillDemo()">Prefill Demo</button>
    <button class="btn secondary" onclick="clearAllPosts()">Clear All</button>
  </div>
</div>

<div class="container">
  <main class="main">
    <div class="cards" id="cardsContainer"></div>
  </main>
</div>

<!-- Modal for Add/Edit -->
<div class="modal" id="adminModal">
  <div class="modal-content">
    <h3 id="modalTitle">New Post</h3>
    <input type="text" id="postTitle" placeholder="Title">
    <textarea id="postBody" placeholder="Body"></textarea>
    <input type="text" id="postSummary" placeholder="Summary">
    <input type="file" id="postImageFile" accept="image/*">
    <select id="postCategory">
      <option value="ahabanza">Ahabanza</option>
      <option value="amakuru">Amakuru</option>
      <option value="politiki">Politiki</option>
      <option value="ubukungu">Ubukungu</option>
      <option value="ubuzima">Ubuzima</option>
      <option value="imikino">Imikino</option>
    </select>
    <div style="display:flex; gap:8px; justify-content:flex-end;">
      <button class="btn primary" id="savePostBtn">Save</button>
      <button class="btn secondary" onclick="closeAdmin()">Cancel</button>
    </div>
  </div>
</div>

<script>
const LS_KEY="amukuru_posts_v1";
let editId=null;

function readPosts(){ try{return JSON.parse(localStorage.getItem(LS_KEY)||"[]");}catch(e){return[];} }
function writePosts(posts){ localStorage.setItem(LS_KEY,JSON.stringify(posts)); }
function uid(){ return Math.random().toString(36).slice(2,10)+Date.now().toString(36).slice(-4); }

function timeAgo(ts){ const sec=Math.floor((Date.now()-ts)/1000); if(sec<60)return sec+"s"; if(sec<3600)return Math.floor(sec/60)+"m"; if(sec<86400)return Math.floor(sec/3600)+"h"; return Math.floor(sec/86400)+"d"; }
function escapeHtml(s){ if(!s)return ''; return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

function renderCards(){
  const posts=readPosts().sort((a,b)=>b.createdAt-a.createdAt);
  const container=document.getElementById('cardsContainer');
  container.innerHTML='';
  posts.forEach(p=>{
    const el=document.createElement('article');
    el.className='card';
    el.innerHTML=`
      <img src="${p.image||placeholderImage()}" alt="">
      <div style="font-weight:700">${escapeHtml(p.title)}</div>
      <div style="font-size:13px;color:#666">${timeAgo(p.createdAt)}</div>
      <p>${escapeHtml(p.summary||p.body.slice(0,120))}</p>
      <div class="card-controls">
        <button class="icon-btn" onclick="editPost('${p.id}')">Edit</button>
        <button class="icon-btn" onclick="deletePost('${p.id}')">Delete</button>
      </div>
    `;
    container.appendChild(el);
  });
}

function openAdmin(){
  editId=null;
  document.getElementById('modalTitle').textContent='New Post';
  document.getElementById('postTitle').value='';
  document.getElementById('postBody').value='';
  document.getElementById('postSummary').value='';
  document.getElementById('postImageFile').value='';
  document.getElementById('postCategory').value='ahabanza';
  document.getElementById('adminModal').style.display='flex';
}

function closeAdmin(){ document.getElementById('adminModal').style.display='none'; }

document.getElementById('savePostBtn').onclick = function(){
  const title=document.getElementById('postTitle').value.trim();
  const body=document.getElementById('postBody').value.trim();
  const summary=document.getElementById('postSummary').value.trim();
  const category=document.getElementById('postCategory').value;
  if(!title||!body){ alert('Title and body required'); return; }

  const fileInput = document.getElementById('postImageFile');
  if(fileInput.files.length>0){
    const reader = new FileReader();
    reader.onload = function(e){
      savePost(title, body, summary, category, e.target.result);
    };
    reader.readAsDataURL(fileInput.files[0]);
  } else {
    savePost(title, body, summary, category, '');
  }
}

function savePost(title, body, summary, category, image){
  const posts = readPosts();
  if(editId){
    const idx = posts.findIndex(p=>p.id===editId);
    if(idx>-1) posts[idx]={...posts[idx], title, body, summary, image, category};
  } else {
    posts.push({id:uid(), title, body, summary, image, category, createdAt:Date.now()});
  }
  writePosts(posts);
  closeAdmin();
  renderCards();
}

function editPost(id){
  const posts=readPosts();
  const p=posts.find(x=>x.id===id);
  if(!p) return;
  editId=id;
  document.getElementById('modalTitle').textContent='Edit Post';
  document.getElementById('postTitle').value=p.title;
  document.getElementById('postBody').value=p.body;
  document.getElementById('postSummary').value=p.summary;
  document.getElementById('postCategory').value=p.category;
  document.getElementById('postImageFile').value='';
  document.getElementById('adminModal').style.display='flex';
}

function deletePost(id){
  if(!confirm('Delete this post?')) return;
  const posts=readPosts().filter(p=>p.id!==id);
  writePosts(posts);
  renderCards();
}

function prefillDemo(){
  const demo=[{
    id:uid(), title:'Demo Post', summary:'Demo summary', body:'Demo content...', image:placeholderImage(),
    category:'ahabanza', createdAt:Date.now()
  }];
  writePosts(demo);
  renderCards();
}

function clearAllPosts(){ if(confirm('Clear all posts?')){ writePosts([]); renderCards(); } }

function placeholderImage(){ 
  return 'data:image/svg+xml;charset=UTF-8,'+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='800'><rect width='100%' height='100%' fill='%23ddd'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23777' font-size='28'>No Image</text></svg>`); 
}

renderCards();
</script>
</body>
</html>
